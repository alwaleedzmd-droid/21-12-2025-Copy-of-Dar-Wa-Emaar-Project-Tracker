# โจ ูุธุงู ุชุญุฏูุซ ูุญูุธ ุญุงูุงุช ุงููุฑุงุญู

## ๐ฏ ุงููุฏู ุงูุฃุณุงุณู

ุญู ูุดููุฉ ุนุฏู ุญูุธ ุชุบููุฑุงุช ุงููุฑุงุญู ูุงูููุงููุงุช. **ุงููุธุงู ุงูุฌุฏูุฏ ูุณูุญ ุจู:**
1. โ ุชุญุฏูุซ ุญุงูุฉ ูู ูุฑุญูุฉ (pending โ in_progress โ completed)
2. โ ุฅุถุงูุฉ ููุงุญุธุงุช ุนูู ุงููุฑุญูุฉ
3. โ ุญูุธ ูุนูููุงุช ูู ูุงู ุจุฅููุงุก ุงููุฑุญูุฉ
4. โ ุฅุถุงูุฉ ุชุนูููุงุช ุนูู ุงููุฑุงุญู
5. โ ุนุฑุถ ุงูุชุงุฑูุฎ ูุงูููุช ููุชุญุฏูุซุงุช

## ๐ ุงููููุงุช ุงูุฌุฏูุฏุฉ

### 1. `services/workflowStageService.ts`
ุฎุฏูุฉ ุดุงููุฉ ูุฅุฏุงุฑุฉ ุชุญุฏูุซุงุช ุงููุฑุงุญู:

```typescript
// ุชุญุฏูุซ ุญุงูุฉ ูุฑุญูุฉ
updateStageProgress(progressId, data)

// ุจุฏุก ุชูููุฐ ูุฑุญูุฉ
startStage(progressId, completedBy)

// ุฅููุงู ูุฑุญูุฉ
completeStage(progressId, completedBy, notes)

// ุฅุนุงุฏุฉ ุชุนููู ูุฑุญูุฉ
resetStage(progressId)

// ุฅุถุงูุฉ ุชุนููู ุนูู ูุฑุญูุฉ
addStageComment(stageProgressId, userEmail, userName, comment)

// ุฌูุจ ุชุนูููุงุช ุงููุฑุญูุฉ
getStageComments(stageProgressId)

// ุชููุฆุฉ ุฌููุน ูุฑุงุญู ุทูุจ ุฌุฏูุฏ
initializeStagesForRequest(requestId, requestType, workflowRouteId)
```

### 2. `components/StageUpdateModal.tsx`
ูููู Modal ูุชุญุฏูุซ ุงููุฑุงุญู ูุน:
- โ ุฃุฒุฑุงุฑ ุชุบููุฑ ุงูุญุงูุฉ (pending โ in_progress โ completed)
- โ ุญูู ูุฅุถุงูุฉ ููุงุญุธุงุช
- โ ูุณู ุงูุชุนูููุงุช ูุน ุฅููุงููุฉ ุงูุฅุถุงูุฉ
- โ ุนุฑุถ ูุนูููุงุช ูู ูุงู ุจู ุงูุนูู
- โ ุนุฑุถ ุงูุชูุงุฑูุฎ ูุงูุฃููุงุช

## ๐ ุงูุชุฏูู ุงูุฌุฏูุฏ

### ุนูุฏ ูุชุญ ุชูุงุตูู ุงูุทูุจ:
```
1. ูุชุญ Modal ุชูุงุตูู ุงูุทูุจ
   โ
2. ุฌูุจ ุงููุฑุงุญู ูู workflow_stages
   โ
3. ุฌูุจ ุญุงูุฉ ุงููุฑุงุญู ูู workflow_stage_progress
   โ
4. ุนุฑุถ ูู ูุฑุญูุฉ ูุน ุฒุฑ Edit (ููู ุงูุชุนุฏูู)
```

### ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ Edit:
```
1. ูุชุญ StageUpdateModal
   โ
2. ุนุฑุถ:
   - ุงุณู ุงููุฑุญูุฉ ูุงููุณุคูู
   - ุญุงูุฉ ุงููุฑุญูุฉ ุงูุญุงููุฉ
   - ุฃุฒุฑุงุฑ ุชุบููุฑ ุงูุญุงูุฉ
   - ุญูู ุงูููุงุญุธุงุช
   - ูุณู ุงูุชุนูููุงุช
   โ
3. ุชุญุฏูุซ ุงูุญุงูุฉ โ ูุญูุธ ูู workflow_stage_progress
   โ
4. ุฅุนุงุฏุฉ ุชุญููู ุงููุฑุงุญู ุนูู ุงูููุฑ
```

## ๐จ ูุงุฌูุฉ ุชุญุฏูุซ ุงููุฑุญูุฉ

### ุฃุฒุฑุงุฑ ุชุบููุฑ ุงูุญุงูุฉ
```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ูู ุงูุงูุชุธุงุฑ โ ููุฏ ุงูุชูููุฐ โ   ููุชูู      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
   (ุฑูุงุฏู)       (ุฃุฒุฑู)         (ุฃุฎุถุฑ)
```

### ุฏูุฑุฉ ุงููุฑุงุญู
```
ูู ุงูุงูุชุธุงุฑ
    โ
ููุฏ ุงูุชูููุฐ (+ ููุงุญุธุงุช ุงุฎุชูุงุฑูุฉ)
    โ
ููุชูู (+ ููุงุญุธุงุช ุฅุฌุจุงุฑูุฉ)
    โ
ูููู ุงูุนูุฏุฉ ุฅูู ูู ุงูุงูุชุธุงุฑ ููุชุตุญูุญ
```

## ๐พ ุงูุจูุงูุงุช ุงููุญููุธุฉ

### ุฌุฏูู workflow_stage_progress
```
{
  id: 1,
  request_id: 123,                    // ูุนุฑู ุงูุทูุจ
  request_type: 'DEED_CLEARANCE',     // ููุน ุงูุทูุจ
  stage_id: 5,                        // ูุนุฑู ุงููุฑุญูุฉ
  status: 'in_progress',              // ุงูุญุงูุฉ ุงูุญุงููุฉ
  started_at: '2026-02-24T10:30:00',  // ููุช ุงูุจุฏุก
  completed_at: null,                 // ููุช ุงูุงูุชูุงุก (ุฅุฐุง ุงูุชููุช)
  completed_by: 'ุฃุญูุฏ ูุญูุฏ',          // ูู ูุงู ุจุฅููุงุก ุงููุฑุญูุฉ
  notes: 'ุชู ุจูุฌุงุญ - ุจุฏูู ูุดุงูู',     // ููุงุญุธุงุช ุงูุฅูุฌุงุฒ
  created_at: '2026-02-24T10:00:00',
  updated_at: '2026-02-24T10:30:00'
}
```

### ุฌุฏูู workflow_stage_comments
```
{
  id: 1,
  stage_progress_id: 1,               // ูุนุฑู ุชูุฏู ุงููุฑุญูุฉ
  user_email: 'ahmed@darwaemaar.com', // ุจุฑูุฏ ุงููุณุชุฎุฏู
  user_name: 'ุฃุญูุฏ ูุญูุฏ',             // ุงุณู ุงููุณุชุฎุฏู
  comment: 'ุชู ุชุณููู ุงููุฎุทุทุงุช',      // ุงูุชุนููู
  created_at: '2026-02-24T10:35:00'
}
```

## ๐ ูุซุงู ุนููู: ุทูุจ ุฅูุฑุงุบ

### ุงููุณุงุฑ ุงููุงูู:
```
1๏ธโฃ ุชูุฏูู ุงูุทูุจ
   ุขุฎุฑ ูู 1 ุฅูู 4 ูุฑุงุญู (pending)

2๏ธโฃ ูุชุญ ุชูุงุตูู ุงูุทูุจ
   - ุงููุฑุญูุฉ 1: ุทูุจ ูุฑุฒ ูุญุฏุงุช [ูู ุงูุงูุชุธุงุฑ]
   - ุงููุฑุญูุฉ 2: ุฅุตุฏุงุฑ ุตููู [ูู ุงูุงูุชุธุงุฑ]
   - ุงููุฑุญูุฉ 3: ุฑูุน ุงูุญุฌุฒ [ูู ุงูุงูุชุธุงุฑ]
   - ุงููุฑุญูุฉ 4: ุชุญุฏูุซ ุงูุจูุงูุงุช [ูู ุงูุงูุชุธุงุฑ]

3๏ธโฃ ุงูุถุบุท ุนูู ุฒุฑ Edit ูููุฑุญูุฉ 1
   โ ูุชุญ StageUpdateModal
   โ ุชุญุฏูุฏ "ููุฏ ุงูุชูููุฐ"
   โ ุงูุถุบุท ุนูู ุงูุฒุฑ
   โ ูุญูุธ ุงููุธุงู: started_at + status

4๏ธโฃ ุจุนุฏ ุงูุชูุงุก ุงููุฑุญูุฉ 1
   โ ุงูุถุบุท ุนูู Edit ูุฌุฏุฏุงู
   โ ุชุญุฏูุฏ "ููุชูู"
   โ ุฅุถุงูุฉ ููุงุญุธุฉ: "ุชู ุงููุฑุฒ ุจูุฌุงุญ"
   โ ุงูุถุบุท ุนูู "ุญูุธ ุงูููุงุญุธุงุช"
   โ ูุญูุธ ุงููุธุงู: status + completed_at + completed_by + notes

5๏ธโฃ ุงููุฑุญูุฉ 2 ุชุจุฏุฃ ุชููุงุฆูุงู
   (ุญุณุจ ุฑุบุจุฉ ุงููุณุชุฎุฏู ุฃู ูุฏูููุงู)

6๏ธโฃ ุจุนุฏ ุงูุชูุงุก ุฌููุน ุงููุฑุงุญู
   โ ุงูุทูุจ ูุธูุฑ ูู "ููุชูู ุจูุฌุงุญ"
```

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ

### ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงููุฑุงุญู:
1. ูุชุญ ุทูุจ ุฅูุฑุงุบ ุฃู ุทูุจ ููู
2. ุงูุจุญุซ ุนู ูุณู "ุณูุฑ ุงูููุงููุงุช"
3. ุงูุถุบุท ุนูู ุฃููููุฉ ุงูููู (Edit) ุจุฌุงูุจ ุฃู ูุฑุญูุฉ
4. ุชุบููุฑ ุงูุญุงูุฉ ูุงุฎุชุจุงุฑ ุงูุฃุฒุฑุงุฑ
5. ุฅุถุงูุฉ ููุงุญุธุงุช
6. ุฅุถุงูุฉ ุชุนูููุงุช
7. ุฅุบูุงู Modal ูุงูุชุญูู ูู ุงูุชุญุฏูุซุงุช

### ุงูุชุญูู ูู ุงูุญูุธ:
- โ ุชุญุฏูุซ ุงูุญุงูุฉ ูุธูุฑ ููุฑุงู
- โ ุงูููุงุญุธุงุช ุชูุญูุธ ุจูุฌุงุญ
- โ ุงูุชุนูููุงุช ุชุธูุฑ ูุน ุงูุงุณู ูุงูููุช
- โ ุงูุชุงุฑูุฎ ูุงูููุช ูุชุญุฏุซุง ุจุดูู ุตุญูุญ

## โ๏ธ ุงูุชูุงููุงุช ุงููุทููุจุฉ

### ุฌุงูุฒุฉ ุจุงููุนู:
โ DeedsDashboard (ุทูุจุงุช ุงูุฅูุฑุงุบ)
โ ManageRequestModal (ุงูุทูุจุงุช ุงููููุฉ)

### ูููู ุชูุณูุนูุง ูู:
- StageUpdateModal ูู ููุงูุน ุฃุฎุฑู
- Automation: ุชุญุฏูุซ ุชููุงุฆู ูููุฑุงุญู
- Notifications: ุฅุดุนุงุฑุงุช ุนูุฏ ุงูุชูุงู ุงููุฑุงุญู

## ๐ ุญู ุงููุดุงูู

### ุงููุดููุฉ: ูุง ุชุธูุฑ ุงููุฑุงุญู
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชูููุฐ migration `20260224_create_workflow_stages_system.sql`
2. ุชุฃูุฏ ูู ูุฌูุฏ workflow_routes ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. ุชุญูู ูู console ููุฃุฎุทุงุก

### ุงููุดููุฉ: ูุง ูุชู ุญูุธ ุงูุชุบููุฑุงุช
**ุงูุญู:**
1. ุชุญูู ูู RLS permissions
2. ุชุฃูุฏ ูู ุฃู ุงูุฌูุงุช ุงูููุซููุฉ ูุฏู ุตูุงุญูุงุช INSERT/UPDATE
3. ุชุญูู ูู ุงูุดุจูุฉ

### ุงููุดููุฉ: ุงูุชุนูููุงุช ูุง ุชุธูุฑ
**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชูููุฐ `20260224_create_stage_comments.sql`
2. ุชุญูู ูู workflow_stage_comments ูู Database
3. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ

## ๐ ููุงุญุธุงุช ูููุฉ

1. **ุงูููุงุญุธุงุช ุงูุฅุฌุจุงุฑูุฉ**: ุนูุฏ ุชุญุฏูุฏ "ููุชูู" ูุฌุจ ุฅุถุงูุฉ ููุงุญุธุฉ
2. **ุฏูุฑุฉ ุงููุฑุงุญู**: ุงููุฑุงุญู ุชุชุญูู ุจูุง WORKFLOW_ROUTES
3. **ุงูุชุนูููุงุช**: ูููุตูุฉ ุนู ุงูููุงุญุธุงุช - ููุชูุงุตู ุจูู ุงููุฑูู
4. **ุงูุฃุฑุดูุฉ**: ุฌููุน ุงูุชุญุฏูุซุงุช ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ุงูุฎุทูุงุช ุงููุงุฏูุฉ

1. **Automation**: ุชุญุฏูุซ ุชููุงุฆู ูููุฑุงุญู ุจูุงุกู ุนูู ุฃุญุฏุงุซ ุงููุธุงู
2. **Reports**: ุชูุงุฑูุฑ ุฒูููุฉ ููู ูุฑุญูุฉ
3. **SLA Tracking**: ุชุชุจุน ุงูุงูุชุฒุงู ุจุงูููุงุนูุฏ
4. **Workflow Rules**: ููุงุนุฏ ุชููุงุฆูุฉ ูุงูุชูุงู ุงููุฑุงุญู
